<%- include('../user/header') %>
<%- include('../user/sideSongSuggestion') %>
<div class="col-md-8 col-sm-12 content-height shadow-lg rounded-3">
    <div class="d-flex justify-content-end mb-2 mt-2">
        <input type="text" id="searchInput" class="form-control w-25" placeholder="Search..." aria-label="Search songs">
    </div>
    <div class="table-container">
        <table class="table table-hover table-sm" id="songsTable">
            <thead>
                <tr>
                    <th></th>
                    <th></th>
                    <th>Title</th>
                    <th>Album</th>
                    <th class="text-end">Duration</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                <% if (allSongs.length===0) { %>
                    <tr class="align-middle">
                        <td colspan="6" class="text-center">No songs found</td>
                    </tr>
                <% } else { %>
                    <% allSongs.forEach((allSong, index) => { %>
                        <tr class="align-middle">
                            <td>
                                <%= index + 1 %>
                            </td>
                            <td>
                                <button
                                    class="play-button"
                                    data-song-id="<%= allSong.song_id %>"
                                    data-file-url="/<%= allSong.file_url %>"
                                    data-title="<%= allSong.title %>" 
                                    data-artist="<%= allSong.artist %>"
                                    data-playlistId="<%= typeof playlistId !== 'undefined' ? playlistId : null %>"
                                >
                                    <i class="fa-solid fa-play"></i>
                                </button>
                            </td>
                            <td>
                                <a href="/songs/<%= allSong.song_id %>" class="text-decoration-none">
                                    <strong>
                                        <%= allSong.title %>
                                    </strong><br>
                                    <small>
                                        <%= allSong.artist %>
                                    </small>
                                </a>
                            </td>
                            <td>
                                <%= allSong.album %>
                            </td>
                            <td class="text-end">
                                <%= allSong.duration %>
                            </td>
                            <td class="text-end">
                                <a 
                                    href="#"
                                    aria-label="Add Song" 
                                    data-bs-toggle="modal"
                                    data-bs-target="#addSongPlaylistModal" 
                                    onclick="setCurrentSongId('<%= allSong.song_id %>'); event.stopPropagation();"
                                >
                                    <i class="fa-regular fa-square-plus fa-2xl" style="color: #74C0FC;"></i>
                                </a>
                            </td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
        </table>
    </div>
</div>
<%- include('../user/footer') %>
<script src="/js/checkConnection.js"></script>
<script src="/js/songPlayerHandler.js" defer></script>